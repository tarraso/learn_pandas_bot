# Руководство: Вопросы с множественным выбором

## 📋 Как это работает

### 1. Хранение вариантов ответов в БД

Варианты ответов хранятся в модели `Question` в полях:
- `option_a` - Вариант A
- `option_b` - Вариант B
- `option_c` - Вариант C
- `option_d` - Вариант D
- `correct_option` - Правильный ответ (A/B/C/D)

### 2. Отображение вопроса в боте

Когда пользователь получает вопрос (`/next`), бот:

**Отправляет вопрос:**
```
📝 Очистка и подготовка данных | Beginner

Как проверить наличие пропущенных значений в pandas DataFrame?

┌─────────────────────────────────┐
│ A. df.missing()                 │ ← Кнопка
├─────────────────────────────────┤
│ B. df.isna()                    │ ← Кнопка
├─────────────────────────────────┤
│ C. df.check_null()              │ ← Кнопка
├─────────────────────────────────┤
│ D. df.find_nan()                │ ← Кнопка
└─────────────────────────────────┘
```

### 3. Обработка ответа

Когда пользователь нажимает кнопку, бот:

1. **Получает выбор** из `callback_data` (например, "answer:B")
2. **Проверяет правильность** сравнивая с `question.correct_option`
3. **Записывает результат** в базу данных
4. **Показывает полное объяснение**

**При правильном ответе:**
```
✅ Правильно!

Ваш ответ: B. df.isna()

💡 Объяснение:
df.isna() возвращает DataFrame с булевыми значениями,
показывающими где находятся пропущенные значения (NaN).
Также можно использовать df.isnull(), который является алиасом.

📖 Документация Pandas

┌─────────────────────────────────┐
│ Следующий вопрос →              │ ← Кнопка
└─────────────────────────────────┘
```

**При неправильном ответе:**
```
❌ Неправильно!

Ваш ответ: A. df.missing()
Правильный ответ: B. df.isna()

💡 Объяснение:
df.isna() возвращает DataFrame с булевыми значениями...

┌─────────────────────────────────┐
│ Следующий вопрос →              │ ← Кнопка
└─────────────────────────────────┘
```

## 🔧 Реализация в коде

### Создание кнопок (run_bot.py:184-193)

```python
# Получаем варианты ответов из БД
options = question.get_options()  # [(A, text), (B, text), ...]

# Создаем кнопки
keyboard = []
for option_letter, option_text in options:
    keyboard.append([
        InlineKeyboardButton(
            f"{option_letter}. {option_text}",
            callback_data=f"answer:{option_letter}"
        )
    ])

reply_markup = InlineKeyboardMarkup(keyboard)
```

### Обработка ответа (run_bot.py:263-323)

```python
# Получаем выбранный вариант
_, selected_option = query.data.split(":")  # "answer:B" → "B"

# Проверяем правильность
is_correct = selected_option == question.correct_option

# Получаем тексты вариантов
options_map = {
    'A': question.option_a,
    'B': question.option_b,
    'C': question.option_c,
    'D': question.option_d
}

selected_text = options_map[selected_option]
correct_text = options_map[question.correct_option]

# Формируем ответ
if is_correct:
    response = "✅ Правильно!\n\n"
    response += f"Ваш ответ: **{selected_option}. {selected_text}**\n\n"
else:
    response = "❌ Неправильно!\n\n"
    response += f"Ваш ответ: **{selected_option}. {selected_text}**\n"
    response += f"Правильный ответ: **{question.correct_option}. {correct_text}**\n\n"

response += f"💡 **Объяснение:**\n{question.explanation}"
```

## 📊 Статистика ответов

Все ответы сохраняются в модели `QuestionHistory`:
- Пользователь
- Вопрос
- Выбранный ответ
- Правильность
- Время ответа

Это позволяет:
- Отслеживать прогресс пользователя
- Показывать статистику (`/stats`)
- Не повторять уже отвеченные вопросы

## 🎯 Преимущества текущей реализации

✅ **Варианты в БД** - легко изменять через админку
✅ **Кнопки Telegram** - удобный интерфейс для выбора
✅ **Полный текст ответа** - пользователь видит, что именно выбрал
✅ **Детальное объяснение** - после ответа показывается полное объяснение
✅ **История ответов** - все сохраняется для статистики
✅ **Русский язык** - все тексты переведены

## 🚀 Как протестировать

1. Отправьте боту команду `/next`
2. Вы увидите вопрос с 4 кнопками (A, B, C, D)
3. Нажмите на любую кнопку
4. Получите результат с объяснением
5. Нажмите "Следующий вопрос →" для продолжения

## 💡 Возможные улучшения

- ⭐ Добавить таймер на ответ
- ⭐ Показывать правильные/неправильные ответы разными цветами (эмодзи)
- ⭐ Добавить режим "экзамена" (несколько вопросов подряд, результат в конце)
- ⭐ Добавить подсказки (использовать 50/50, убрать два неправильных варианта)
